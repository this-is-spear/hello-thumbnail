# 클라이언트 썸네일 관리 서비스

## 개요

썸네일을 사이즈별로 S3에 관리한다면 요구되는 용량이 기하급수적으로 많아지게 됩니다.
요청된 이미지에 따라 리사이징한다면 요구되는 용량을 줄일 수 있습니다.

클라이언트에서 사용하는 이미지는 대부분 동일한 요청을 띄게 됩니다. 

## 요구사항

- 팀원은 이미지를 업로드해서 원하는 사이즈의 이미지를 사용자들에게 제공 할 수 있다.

## 프로그래밍 요구사항

- 이미지 식별자와 사이즈를 입력받아 리사이징 후 반환한다.

## 서비스 흐름

1. 팀원은 이미지를 업로드한다.
2. 팀원은 이미지 주소를 얻는다.
3. 팀원은 이미지와 이미지 이름 이미지 주소가 포함된 리스트를 얻는다.
4. 사용자는 이미지 식별자와 사이즈를 입력해 리사이즈된 이미지를 반환받는다.

## 이후 최적화

- 서비스 안정성을 높이기 위해 트래픽을 줄이자.
  1. 사용자는 이미지 식별자와 사이즈를 입력할 떄, CDN에 등록되어 있으면 304를 반환한다.
  2. CDN에 저장되지 않았다면 S3에 업로드된 이미지를 다운로드 받아 리사이징 후 CDN에 전달하고 200 OK를 반환한다.
- 서비스 안정성을 높이기 위해 동일한 리사이징 요청이 발생하지 않도록 제어한다.
  1. 메타데이터를 활용한 데이터베이스를 이용해 작업 동시성을 수행한다.
  2. 작업을 시작하면 메타데이터가 작업중이라는 로그를 남긴다.
  3. 작업 중간에 동일한 요청이 온다면 해당 요청들을 대기시킨다.
  4. 작업이 완료되면 CDN에 등록하고 모든 요청에 200 OK를 반환한다.
